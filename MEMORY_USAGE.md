# 메모리 사용량 분석

멀티유저 파이썬 IDE의 메모리 효율성 분석 및 최적화 결과.

## 📊 실측 데이터

### 사용자별 메모리 사용량

| 사용자 수         | 실제 메모리 | 구성                         |
| ----------------- | ----------- | ---------------------------- |
| **1명**           | 85 MB       | Node.js(67MB) + pylsp(48MB)  |
| **2명**           | 155 MB      | +pylsp(63MB) + 오버헤드(7MB) |
| **사용자당 평균** | **~70 MB**  | pylsp 프로세스 + WebSocket   |

### 프로세스 상세

- **Node.js 서버**: 67-69 MB (고정)
- **pylsp 프로세스**: 48-63 MB (사용자당)
- **WebSocket 세션**: 1-2 MB (사용자당)

---

## 📈 멀티유저 예측

### 메모리 공식

```
총 메모리 = 85MB + (추가 사용자 × 70MB)
```

### 사용자 수별 예상

| 사용자 | 메모리 (프로세스 풀 비활성) | 메모리 (프로세스 풀 활성) |
| ------ | --------------------------- | ------------------------- |
| 10명   | 715 MB                      | 715 MB                    |
| 20명   | 1.4 GB                      | **1.4 GB** ⚠️ Cap 도달    |
| 50명   | 3.5 GB                      | **1.6 GB** ✅             |
| 100명  | 7.1 GB                      | **1.6 GB** ✅             |
| 200명  | 14.1 GB                     | **1.9 GB** ✅             |

> **프로세스 풀**: 최대 20개로 제한, 5분 idle 후 재사용

---

## 🎯 최적화 효과

### 개선 전후 비교 (100명 기준)

```
Before: 15 GB (사용자당 별도 프로세스)
After:  1.6 GB (프로세스 풀 재사용)

절감률: 89% 🎉
```

### LSP 프로세스 풀 설정

```javascript
maxProcesses: 20; // 최대 프로세스 수
idleTimeout: 300000; // 5분 유휴 후 정리
```

---

## 🔧 설정 조정 가이드

### 소규모 (10명 이하)

```javascript
maxProcesses: 10;
idleTimeout: 180000; // 3분
```

**예상 메모리**: ~700 MB

### 중규모 (10-50명)

```javascript
maxProcesses: 20; // 기본값
idleTimeout: 300000; // 5분
```

**예상 메모리**: ~1.4 GB

### 대규모 (50명 이상)

```javascript
maxProcesses: 30;
idleTimeout: 600000; // 10분
```

**예상 메모리**: ~2.1 GB

---

## 📝 모니터링 명령어

### Docker 메모리 확인

```bash
docker stats <container_name> --no-stream
```

### 프로세스 확인

```bash
docker exec <container_name> ps aux | grep pylsp
```

### 로그에서 풀 상태 확인

```bash
docker logs <container_name> | grep poolSize
```

---

## 🚀 성능 특징

✅ **사용자당 70MB** - 예측 가능한 메모리 사용
✅ **프로세스 풀** - 최대 20개로 자동 제한
✅ **자동 정리** - 5분 idle 후 메모리 회수
✅ **선형 확장** - 20명까지 선형, 이후 상수

**권장 서버 스펙**:

- 10명: 1GB RAM
- 50명: 2GB RAM
- 100명: 3GB RAM
- 200명: 4GB RAM

---

**관련 문서**: [메모리 누수 개선사항](./MEMORY_LEAK_FIXES.md)
