import{l as c,e as h,U as f,R as b}from"./monaco-editor-6607de6a.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function v(){return new Worker("/assets/editor.worker-94ffd778.js")}self.MonacoEnvironment={getWorker(){return new v}};class w{constructor(){this.editor=null,this.openTabs=new Map,this.activeFile=null,this.fileExplorer=document.getElementById("fileExplorer"),this.tabBar=document.getElementById("tabBar"),this.filePathBar=document.getElementById("filePathBar"),this.executeButton=document.getElementById("executeButton"),this.outputPanel=document.getElementById("outputPanel"),this.languageClient=null,this.snippets={},this.ctrlPressed=!1,this.currentLinkDecorations=[],this.selectedDirectory="",this.contextMenuTarget=null;const e=new URLSearchParams(window.location.search);this.workspaceFolder=e.get("folder")||"",this.splitViewActive=!1,this.rightEditor=null,this.rightOpenTabs=new Map,this.rightActiveFile=null,this.focusedEditor="left",this.syncInProgress=!1,this.modelChangeListeners=new Map,this.initializeEditor(),this.initializeLanguageServer(),this.loadSnippets(),this.loadFileExplorer(),this.setupEventListeners(),this.initializeSidebarResize()}getFetchHeaders(){const e={"Content-Type":"application/json"};return this.workspaceFolder&&this.workspaceFolder.trim()!==""&&(e["x-workspace-folder"]=this.workspaceFolder),e}buildUrl(e,t={}){const s=new URL(e,window.location.origin);return this.workspaceFolder&&this.workspaceFolder.trim()!==""&&s.searchParams.set("folder",this.workspaceFolder),Object.entries(t).forEach(([i,o])=>{s.searchParams.set(i,o)}),s.toString()}async initializeEditor(){c.typescript.javascriptDefaults.setEagerModelSync(!0),c.register({id:"python"}),this.editor=h.create(document.getElementById("editor"),{value:"# Welcome to Python IDE\\n# Create or open a Python file to get started\\n",language:"python",theme:"vs-dark",fontSize:14,lineNumbers:"on",minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,wordWrap:"on",folding:!0,foldingStrategy:"indentation",showFoldingControls:"always",tabSize:4,insertSpaces:!0,autoIndent:"full",formatOnPaste:!0,formatOnType:!0,bracketPairColorization:{enabled:!0},guides:{indentation:!0}}),this.editor.onMouseDown(e=>{(e.event.ctrlKey||e.event.metaKey)&&this.handleCtrlClick(e.target.position)}),this.editor.onMouseMove(e=>{this.handleMouseMove(e)}),this.editor.onMouseLeave(()=>{this.clearLinkDecorations()}),this.editor.onKeyDown(e=>{((this.isMac?e.metaKey:e.ctrlKey)||e.ctrlKey||e.metaKey)&&(this.ctrlPressed=!0,this.updateCursorStyle())}),this.editor.onKeyUp(e=>{!(this.isMac?e.metaKey:e.ctrlKey)&&!e.ctrlKey&&!e.metaKey&&(this.ctrlPressed=!1,this.updateCursorStyle(),this.clearLinkDecorations())}),this.ctrlPressed=!1,this.isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,document.addEventListener("keydown",e=>{((this.isMac?e.metaKey:e.ctrlKey)||e.ctrlKey||e.metaKey)&&(this.ctrlPressed=!0,this.updateCursorStyle())}),document.addEventListener("keyup",e=>{!(this.isMac?e.metaKey:e.ctrlKey)&&!e.ctrlKey&&!e.metaKey&&(this.ctrlPressed=!1,this.updateCursorStyle(),this.clearLinkDecorations())}),this.editor.onDidChangeModelContent(()=>{if(this.activeFile){this.saveFile(this.activeFile);const e=this.editor.getValue();this.notifyDocumentChanged(this.activeFile,e)}}),this.setupCodeCompletion()}setupCodeCompletion(){c.registerCompletionItemProvider("python",{provideCompletionItems:(e,t)=>{const s=[];return Object.entries(this.snippets).forEach(([o,n])=>{s.push({label:n.prefix,kind:c.CompletionItemKind.Snippet,insertText:n.body.join(`
`),insertTextRules:c.CompletionItemInsertTextRule.InsertAsSnippet,documentation:n.description,detail:"Python Snippet"})}),["def","class","if","elif","else","for","while","try","except","finally","with","import","from","return","yield","pass","break","continue"].forEach(o=>{s.push({label:o,kind:c.CompletionItemKind.Keyword,insertText:o,detail:"Python Keyword"})}),{suggestions:s}}})}async initializeLanguageServer(){try{const t=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`;this.languageClient=new WebSocket(t),this.messageId=1,this.pendingRequests=new Map,this.languageClient.onopen=()=>{this.initializeLSP()},this.languageClient.onmessage=s=>{try{const i=JSON.parse(s.data);this.handleLSPResponse(i)}catch(i){console.error("Failed to parse LSP response:",i)}},this.languageClient.onerror=s=>{console.error("Language server error:",s),this.setupBasicValidation()},this.languageClient.onclose=()=>{this.setupBasicValidation()}}catch(e){console.error("Failed to connect to language server:",e),this.setupBasicValidation()}}initializeLSP(){const e={jsonrpc:"2.0",id:this.messageId++,method:"initialize",params:{processId:null,clientInfo:{name:"Python IDE",version:"1.0.0"},rootUri:"file:///app/workspace",capabilities:{textDocument:{completion:{dynamicRegistration:!1,completionItem:{snippetSupport:!0,documentationFormat:["markdown","plaintext"]}},definition:{dynamicRegistration:!1,linkSupport:!0},hover:{dynamicRegistration:!1,contentFormat:["markdown","plaintext"]},synchronization:{dynamicRegistration:!1,willSave:!0,didSave:!0}}},workspaceFolders:[{uri:"file:///app/workspace",name:"workspace"}]}};this.sendLSPRequest(e)}sendLSPRequest(e){this.languageClient&&this.languageClient.readyState===WebSocket.OPEN&&(this.languageClient.send(JSON.stringify(e)),e.id&&this.pendingRequests.set(e.id,e))}handleLSPResponse(e){if(e.id&&this.pendingRequests.has(e.id)){const t=this.pendingRequests.get(e.id);switch(this.pendingRequests.delete(e.id),t.method){case"initialize":this.handleInitializeResponse(e);break;case"textDocument/completion":this.handleCompletionResponse(e);break;case"textDocument/definition":this.handleDefinitionResponse(e);break;case"textDocument/hover":this.handleHoverResponse(e);break}}}handleInitializeResponse(e){e.result&&(this.sendLSPRequest({jsonrpc:"2.0",method:"initialized",params:{}}),this.setupAdvancedFeatures())}setupAdvancedFeatures(){c.registerCompletionItemProvider("python",{triggerCharacters:["."," "],provideCompletionItems:async(e,t)=>this.getCompletionItems(e,t)}),c.registerDefinitionProvider("python",{provideDefinition:async(e,t)=>this.getDefinition(e,t)}),c.registerHoverProvider("python",{provideHover:async(e,t)=>this.getHover(e,t)})}setupBasicValidation(){c.registerDocumentFormattingEditProvider("python",{provideDocumentFormattingEdits:e=>{const i=e.getValue().split("\\n").map(o=>o.replace(/^\\s+/,n=>{const r=n.length,a=Math.floor(r/4);return"    ".repeat(a)}));return[{range:e.getFullModelRange(),text:i.join("\\n")}]}})}async getCompletionItems(e,t){try{const s=e.uri.toString(),i=e.getValue(),o=this.activeFile||"temp.py";let n;o.startsWith("/usr/local/lib/python3.11/")?n=`file://${o}`:n=`file:///app/workspace/${o}`,this.sendLSPRequest({jsonrpc:"2.0",method:"textDocument/didChange",params:{textDocument:{uri:n,version:Date.now()},contentChanges:[{text:i}]}});const r={jsonrpc:"2.0",id:this.messageId++,method:"textDocument/completion",params:{textDocument:{uri:n},position:{line:t.lineNumber-1,character:t.column-1}}};return new Promise(a=>{this.completionResolve=a,this.sendLSPRequest(r),setTimeout(()=>{this.completionResolve===a&&(this.completionResolve=null,a(this.getBasicCompletions()))},1e3)})}catch(s){return console.error("Completion error:",s),this.getBasicCompletions()}}getBasicCompletions(){const e=[];return Object.entries(this.snippets).forEach(([s,i])=>{e.push({label:i.prefix,kind:c.CompletionItemKind.Snippet,insertText:i.body.join(`
`),insertTextRules:c.CompletionItemInsertTextRule.InsertAsSnippet,documentation:i.description,detail:"Python Snippet"})}),["def","class","if","elif","else","for","while","try","except","finally","with","import","from","return","yield","pass","break","continue","lambda","and","or","not","in","is","None","True","False"].forEach(s=>{e.push({label:s,kind:c.CompletionItemKind.Keyword,insertText:s,detail:"Python Keyword"})}),{suggestions:e}}handleCompletionResponse(e){if(this.completionResolve){const t=this.completionResolve;if(this.completionResolve=null,e.result&&e.result.items){const s=e.result.items.map(i=>({label:i.label,kind:this.convertCompletionItemKind(i.kind),insertText:i.insertText||i.label,detail:i.detail||"",documentation:i.documentation||"",sortText:i.sortText}));t({suggestions:s})}else t(this.getBasicCompletions())}}convertCompletionItemKind(e){return{1:c.CompletionItemKind.Text,2:c.CompletionItemKind.Method,3:c.CompletionItemKind.Function,4:c.CompletionItemKind.Constructor,5:c.CompletionItemKind.Field,6:c.CompletionItemKind.Variable,7:c.CompletionItemKind.Class,8:c.CompletionItemKind.Interface,9:c.CompletionItemKind.Module,10:c.CompletionItemKind.Property,11:c.CompletionItemKind.Unit,12:c.CompletionItemKind.Value,13:c.CompletionItemKind.Enum,14:c.CompletionItemKind.Keyword,15:c.CompletionItemKind.Snippet}[e]||c.CompletionItemKind.Text}async getDefinition(e,t){try{const s=this.activeFile||"temp.py";let i;s.startsWith("/usr/local/lib/python3.11/")?i=`file://${s}`:i=`file:///app/workspace/${s}`,await this.ensureDocumentSynchronized(s,e.getValue());const n={jsonrpc:"2.0",id:this.messageId++,method:"textDocument/definition",params:{textDocument:{uri:i},position:{line:t.lineNumber-1,character:t.column-1}}};return new Promise(r=>{this.definitionResolve=r,this.sendLSPRequest(n),setTimeout(()=>{this.definitionResolve===r&&(this.definitionResolve=null,r(null))},5e3)})}catch(s){return console.error("Definition error:",s),null}}async ensureDocumentSynchronized(e,t){let s;e.startsWith("/usr/local/lib/python3.11/")?s=`file://${e}`:s=`file:///app/workspace/${e}`,this.sendLSPRequest({jsonrpc:"2.0",method:"textDocument/didChange",params:{textDocument:{uri:s,version:Date.now()},contentChanges:[{text:t}]}}),await new Promise(i=>setTimeout(i,100))}handleDefinitionResponse(e){if(this.definitionResolve){const t=this.definitionResolve;if(this.definitionResolve=null,e.result){const s=Array.isArray(e.result)?e.result:[e.result];if(s.length>0){const i=s[0];if(i.uri&&i.range){let o;i.uri.startsWith("file:///app/workspace/")?o=i.uri.replace("file:///app/workspace/",""):i.uri.startsWith("file://")?o=i.uri.replace("file://",""):o=i.uri,t({filePath:o,range:{startLineNumber:i.range.start.line+1,startColumn:i.range.start.character+1,endLineNumber:i.range.end.line+1,endColumn:i.range.end.character+1}});return}}}t(null)}}async getHover(e,t){try{const s=this.activeFile||"temp.py";let i;s.startsWith("/usr/local/lib/python3.11/")?i=`file://${s}`:i=`file:///app/workspace/${s}`;const o={jsonrpc:"2.0",id:this.messageId++,method:"textDocument/hover",params:{textDocument:{uri:i},position:{line:t.lineNumber-1,character:t.column-1}}};return new Promise(n=>{this.hoverResolve=n,this.sendLSPRequest(o),setTimeout(()=>{this.hoverResolve===n&&(this.hoverResolve=null,n(null))},1e3)})}catch(s){return console.error("Hover error:",s),null}}handleHoverResponse(e){if(this.hoverResolve){const t=this.hoverResolve;if(this.hoverResolve=null,e.result&&e.result.contents){let s="";Array.isArray(e.result.contents)?s=e.result.contents.map(i=>typeof i=="string"?i:i.value).join(`

`):typeof e.result.contents=="string"?s=e.result.contents:e.result.contents.value&&(s=e.result.contents.value),t({contents:[{value:s}]})}else t(null)}}async handleCtrlClick(e){if(!e)return;const t=await this.getDefinition(this.editor.getModel(),e);t&&t.filePath&&(console.log("Opening file:",t.filePath),await this.openFile(t.filePath),this.editor.setPosition({lineNumber:t.range.startLineNumber,column:t.range.startColumn}),this.editor.deltaDecorations([],[{range:t.range,options:{className:"highlight-definition",isWholeLine:!1}}]),setTimeout(()=>{this.editor.deltaDecorations([],[])},2e3))}handleMouseMove(e){if(this.ctrlPressed&&e.target){const t=e.target.position;t?this.showLinkAtPosition(t):this.clearLinkDecorations()}else this.clearLinkDecorations()}updateCursorStyle(){const e=document.querySelector(".monaco-editor");e&&(this.ctrlPressed?e.style.cursor="pointer":e.style.cursor="text")}showLinkAtPosition(e){const t=this.editor.getModel();if(!t)return;const s=t.getWordAtPosition(e);if(!s){this.clearLinkDecorations();return}const i=t.getLineContent(e.lineNumber);if(this.isLinkableElement(i,s.word,e)){const n={startLineNumber:e.lineNumber,startColumn:s.startColumn,endLineNumber:e.lineNumber,endColumn:s.endColumn};this.currentLinkDecorations=this.editor.deltaDecorations(this.currentLinkDecorations||[],[{range:n,options:{inlineClassName:"ctrl-hover-link",stickiness:h.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}])}else this.clearLinkDecorations()}isLinkableElement(e,t,s){return e.includes("import")||e.includes("from")||e.substring(s.column-1).startsWith("(")||e.substring(0,s.column-t.length-1).endsWith(".")?!0:/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)}clearLinkDecorations(){this.currentLinkDecorations&&(this.currentLinkDecorations=this.editor.deltaDecorations(this.currentLinkDecorations,[]))}notifyDocumentOpened(e,t){if(this.languageClient&&this.languageClient.readyState===WebSocket.OPEN){let s;e.startsWith("/usr/local/lib/python3.11/")?s=`file://${e}`:s=`file:///app/workspace/${e}`,this.sendLSPRequest({jsonrpc:"2.0",method:"textDocument/didOpen",params:{textDocument:{uri:s,languageId:"python",version:1,text:t}}})}}notifyDocumentChanged(e,t){if(this.languageClient&&this.languageClient.readyState===WebSocket.OPEN){let s;e.startsWith("/usr/local/lib/python3.11/")?s=`file://${e}`:s=`file:///app/workspace/${e}`,this.sendLSPRequest({jsonrpc:"2.0",method:"textDocument/didChange",params:{textDocument:{uri:s,version:Date.now()},contentChanges:[{text:t}]}})}}async loadSnippets(){try{const e=await fetch("/api/snippets");this.snippets=await e.json()}catch(e){console.error("Failed to load snippets:",e)}}async loadFileExplorer(){try{const e=this.workspaceFolder?`/api/files?folder=${encodeURIComponent(this.workspaceFolder)}`:"/api/files",s=await(await fetch(e)).json(),i=s.files||s;if(this.renderFileExplorer(i),this.selectedDirectory){const o=document.querySelector(`[data-path="${this.selectedDirectory}"][data-type="directory"]`);o?o.classList.add("selected"):this.selectedDirectory=""}}catch{this.fileExplorer.innerHTML='<div class="error">Failed to load files</div>'}}renderFileExplorer(e,t=this.fileExplorer,s=0){s===0&&(t.innerHTML="",this.setupExplorerDropZone(t)),e.forEach(i=>{const o=document.createElement("div");if(i.type==="directory"){o.className="file-item folder-item",o.setAttribute("data-path",i.path),o.setAttribute("data-type","directory"),o.setAttribute("draggable","true"),o.innerHTML=`
                    <i class="codicon codicon-chevron-right folder-toggle"></i>
                    <i class="codicon codicon-folder file-icon" style="color: #dcb67a;"></i>
                    <span>${i.name}</span>
                `;const n=document.createElement("div");n.className="folder-content";const r=o.querySelector(".folder-toggle");r.addEventListener("click",a=>{a.stopPropagation(),n.classList.contains("expanded")?(n.classList.remove("expanded"),r.classList.remove("expanded")):(n.classList.add("expanded"),r.classList.add("expanded"),n.children.length===0&&this.renderFileExplorer(i.children,n,s+1))}),o.addEventListener("click",a=>{a.target!==r&&(a.stopPropagation(),document.querySelectorAll(".file-item.selected").forEach(l=>{l.classList.remove("selected")}),o.classList.add("selected"),this.selectedDirectory=i.path)}),o.addEventListener("contextmenu",a=>{a.preventDefault(),this.showContextMenu(a,i.path,"directory")}),this.setupDragEvents(o,i),this.setupDropZone(o,i),t.appendChild(o),t.appendChild(n)}else o.className="file-item",o.setAttribute("data-path",i.path),o.setAttribute("data-type","file"),o.setAttribute("draggable","true"),o.innerHTML=`
                    <span class="file-icon">${this.getFileIcon(i.name)}</span>
                    <span>${i.name}</span>
                `,o.addEventListener("click",()=>{this.openFile(i.path)}),o.addEventListener("contextmenu",n=>{n.preventDefault(),this.showContextMenu(n,i.path,"file")}),this.setupDragEvents(o,i),t.appendChild(o)})}setupExplorerDropZone(e){e.addEventListener("dragover",t=>{t.dataTransfer.types.includes("Files")&&(t.preventDefault(),t.dataTransfer.dropEffect="copy",e.classList.add("drag-over"))}),e.addEventListener("dragleave",t=>{t.target===e&&e.classList.remove("drag-over")}),e.addEventListener("drop",async t=>{t.preventDefault(),e.classList.remove("drag-over");const s=t.dataTransfer.items;if(s&&s.length>0){let o=!1;for(let n=0;n<s.length;n++)if(s[n].webkitGetAsEntry){o=!0;break}if(o){await this.handleDroppedItems(s,"");return}}const i=t.dataTransfer.files;i.length>0&&await this.handleFileUpload(i,"")})}setupDragEvents(e,t){e.addEventListener("dragstart",s=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("application/json",JSON.stringify({path:t.path,name:t.name,type:t.type})),e.classList.add("dragging")}),e.addEventListener("dragend",s=>{e.classList.remove("dragging"),document.querySelectorAll(".drag-over").forEach(i=>{i.classList.remove("drag-over")})})}setupDropZone(e,t){t.type==="directory"&&(e.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation();const i=s.dataTransfer.types.includes("application/json"),o=s.dataTransfer.types.includes("Files");(i||o)&&(s.dataTransfer.dropEffect=i?"move":"copy",e.classList.add("drag-over"))}),e.addEventListener("dragleave",s=>{s.target===e&&e.classList.remove("drag-over")}),e.addEventListener("drop",async s=>{s.preventDefault(),s.stopPropagation(),e.classList.remove("drag-over");const i=s.dataTransfer.getData("application/json");if(i){const r=JSON.parse(i);await this.handleItemMove(r,t.path);return}const o=s.dataTransfer.items;if(o&&o.length>0){let r=!1;for(let a=0;a<o.length;a++)if(o[a].webkitGetAsEntry){r=!0;break}if(r){await this.handleDroppedItems(o,t.path);return}}const n=s.dataTransfer.files;n.length>0&&await this.handleFileUpload(n,t.path)}))}async handleItemMove(e,t){try{if(e.path===t)return;if(t.startsWith(e.path+"/")){alert("Cannot move a folder into itself");return}const s=`${t}/${e.name}`;if(await this.fileExists(s)&&!confirm(`"${e.name}" already exists. Do you want to replace it?`))return;if(!(await fetch(this.buildUrl("/api/move"),{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify({source:e.path,destination:s})})).ok)throw new Error("Failed to move item");if(this.selectedDirectory===e.path?this.selectedDirectory=s:this.selectedDirectory.startsWith(e.path+"/")&&(this.selectedDirectory=this.selectedDirectory.replace(e.path,s)),this.openTabs.has(e.path)){const o=this.openTabs.get(e.path);this.openTabs.delete(e.path),this.openTabs.set(s,o),this.activeFile===e.path&&(this.activeFile=s);const n=document.querySelector(`[data-filepath="${e.path}"]`);n&&(n.setAttribute("data-filepath",s),n.querySelector("span").textContent=e.name)}this.loadFileExplorer()}catch(s){alert("Failed to move item: "+s.message)}}async handleDroppedItems(e,t){try{const s=[];for(let i=0;i<e.length;i++){const o=e[i];if(o.kind==="file"){const n=o.webkitGetAsEntry();n&&await this.traverseFileTree(n,"",s)}}if(s.length===0)return;await this.handleFileUpload(s,t)}catch(s){alert("Failed to process dropped items: "+s.message)}}async traverseFileTree(e,t,s){return new Promise((i,o)=>{if(e.isFile)e.file(n=>{s.push({file:n,relativePath:t+n.name}),i()},o);else if(e.isDirectory){const n=e.createReader(),r=t+e.name+"/",a=()=>{n.readEntries(async l=>{if(l.length===0){i();return}for(const d of l)await this.traverseFileTree(d,r,s);a()},o)};a()}})}async handleFileUpload(e,t){try{const s=new FormData;if(Array.isArray(e)&&e.length>0&&e[0].file)for(const a of e)s.append("files",a.file),s.append("relativePaths",a.relativePath);else for(const a of e)s.append("files",a);s.append("targetPath",t);const i=this.workspaceFolder&&this.workspaceFolder.trim()!==""?`/api/upload?folder=${encodeURIComponent(this.workspaceFolder)}`:"/api/upload",o=await fetch(i,{method:"POST",body:s});if(!o.ok){const a=await o.text();throw new Error(`Failed to upload files: ${a}`)}const n=await o.json(),r=document.createElement("div");r.style.cssText=`
                position: fixed; top: 20px; right: 20px; background: #4CAF50;
                color: white; padding: 8px 16px; border-radius: 4px; z-index: 9999;
                font-size: 14px; pointer-events: none;
            `,r.textContent=`Uploaded ${n.files.length} file(s)`,document.body.appendChild(r),setTimeout(()=>r.remove(),2e3),this.loadFileExplorer()}catch(s){alert("Failed to upload files: "+s.message)}}getFileIcon(e){var i;const t=(i=e.split(".").pop())==null?void 0:i.toLowerCase();this.getFileIconColor(t);const s=(o,n="#c5c5c5")=>`<i class="codicon codicon-${o}" style="color: ${n}; font-size: 16px;"></i>`;switch(t){case"py":return s("symbol-method","#4b8bbe");case"js":return s("symbol-method","#f0db4f");case"jsx":return s("react","#61dafb");case"ts":return s("symbol-method","#3178c6");case"tsx":return s("react","#3178c6");case"json":return s("json","#f0db4f");case"html":case"htm":return s("code","#e34c26");case"css":case"scss":case"sass":return s("symbol-color","#5d8fdb");case"md":case"markdown":return s("markdown","#c5c5c5");case"txt":return s("file","#c5c5c5");case"yml":case"yaml":case"config":case"conf":return s("settings-gear","#e65c5c");case"xml":return s("code","#c5c5c5");case"csv":return s("table","#4db380");case"log":return s("output","#c5c5c5");case"sql":return s("database","#c5c5c5");case"sh":case"bash":return s("terminal-bash","#6bc267");case"php":return s("symbol-method","#9b7cc4");case"java":return s("symbol-method","#5d9bd6");case"c":case"cpp":case"h":return s("file-code","#5d9bd6");case"go":return s("symbol-method","#5dc9e2");case"rs":return s("file-code","#e6b8a2");case"swift":return s("symbol-method","#f27b5b");case"kt":case"kts":return s("file-code","#a87dff");case"rb":return s("ruby","#e65c5c");case"env":return s("symbol-key","#ffd966");case"dockerfile":return s("file-code","#4db3e8");case"gitignore":return s("diff-ignored","#c5c5c5");case"lock":return s("lock","#c5c5c5");case"zip":case"tar":case"gz":return s("file-zip","#c5c5c5");case"png":case"jpg":case"jpeg":case"gif":case"svg":return s("file-media","#c58ae0");case"pdf":return s("file-pdf","#f46060");default:return s("file","#c5c5c5")}}getFileIconColor(e){return{py:"#3776ab",js:"#f0db4f",jsx:"#f0db4f",ts:"#3178c6",tsx:"#3178c6",html:"#e34c26",css:"#264de4",json:"#858585"}[e]||"#858585"}async openFile(e){try{if(this.splitViewActive){if(this.focusedEditor==="right"){if(this.rightOpenTabs.has(e)){this.switchToTabInSplit(e);return}await this.openFileInSplit(e);return}else if(this.openTabs.has(e)){this.switchToTab(e);return}}else if(this.openTabs.has(e)){this.switchToTab(e);return}let t,s;if(e.startsWith("/usr/local/lib/python3.11/")){const o=e.replace("/usr/local/lib/python3.11/","");if(t=await fetch(`/api/stdlib/${o}`),!t.ok)throw new Error(`Failed to load stdlib file: ${e}`);s=await t.json()}else{if(t=await fetch(this.buildUrl(`/api/files/${e}`)),!t.ok)throw new Error(`Failed to load file: ${e}`);s=await t.json()}const i=h.createModel(s.content,this.getLanguageFromFile(e),f.file(e));this.openTabs.set(e,{model:i,saved:!0,isStdlib:e.startsWith("/usr/local/lib/python3.11/")}),this.notifyDocumentOpened(e,s.content),this.createTab(e),this.switchToTab(e)}catch(t){console.error("Failed to open file:",t),alert(`Could not open file: ${e.split("/").pop()}
Error: ${t.message}`)}}getLanguageFromFile(e){var s;switch((s=e.split(".").pop())==null?void 0:s.toLowerCase()){case"py":case"pyi":return"python";case"js":return"javascript";case"json":return"json";case"html":return"html";case"css":return"css";default:return"plaintext"}}createTab(e){const t=e.split("/").pop(),s=e.startsWith("/usr/local/lib/python3.11/"),i=document.createElement("div");i.className="tab",i.dataset.filepath=e,i.innerHTML=`
            <span class="tab-label">${t}${s?" (read-only)":""}</span>
            <i class="codicon codicon-close tab-close"></i>
        `,s&&i.classList.add("stdlib-tab"),i.setAttribute("draggable","true"),i.addEventListener("click",o=>{o.target.classList.contains("tab-close")?this.closeTab(e):(this.focusedEditor="left",this.switchToTab(e),this.splitViewActive&&this.updateEditorFocusVisual())}),i.addEventListener("dragstart",o=>{o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/plain",e),o.dataTransfer.setData("editor-group","left"),i.classList.add("dragging")}),i.addEventListener("dragend",o=>{i.classList.remove("dragging"),document.querySelectorAll(".tab").forEach(n=>n.classList.remove("drag-over"))}),i.addEventListener("dragover",o=>{o.preventDefault(),o.dataTransfer.dropEffect="move";const n=document.querySelector(".tab.dragging");if(n&&n!==i&&n.closest("#tabBar")){const r=i.getBoundingClientRect(),a=r.left+r.width/2;o.clientX<a?i.parentNode.insertBefore(n,i):i.parentNode.insertBefore(n,i.nextSibling)}}),i.addEventListener("contextmenu",o=>{o.preventDefault(),this.showTabContextMenu(o,e)}),this.tabBar.appendChild(i)}switchToTab(e){document.querySelectorAll(".tab").forEach(i=>{i.classList.remove("active")});const t=document.querySelector(`[data-filepath="${e}"]`);t&&t.classList.add("active");const s=this.openTabs.get(e);if(s){this.editor.setModel(s.model),this.activeFile=e,this.updateFilePathDisplay(e,s.isStdlib),this.updateActiveFileHighlight();const i=e.endsWith(".py");this.executeButton.style.display=i&&!s.isStdlib?"block":"none",this.splitViewActive&&this.setupModelSync(e)}}closeTab(e){this.cleanupSyncListener(e);const t=this.openTabs.get(e);t&&(t.model.dispose(),this.openTabs.delete(e));const s=document.querySelector(`[data-filepath="${e}"]`);if(s&&s.remove(),this.activeFile===e){const i=document.querySelectorAll(".tab");if(i.length>0){const o=i[0].dataset.filepath;this.switchToTab(o)}else this.activeFile=null,this.editor.setModel(null),this.executeButton.style.display="none"}}async saveFile(e){const t=this.openTabs.get(e);if(t)try{const s=t.model.getValue();await fetch(this.buildUrl(`/api/files/${e}`),{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify({content:s})}),t.saved=!0}catch(s){console.error("Failed to save file:",s)}}async executeCode(e="left"){const t=e==="left"?this.activeFile:this.rightActiveFile,s=e==="left"?this.openTabs:this.rightOpenTabs,i=e==="left"?this.outputPanel:document.getElementById("outputPanel2");if(!t||!t.endsWith(".py"))return;const o=s.get(t);if(!o)return;const n=o.model.getValue(),r=t.split("/").pop();try{i&&(i.style.display="block",i.className="output-panel",i.textContent="Executing...");const l=await(await fetch("/api/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,filename:r})})).json();i&&(l.success?i.textContent=l.output||"Code executed successfully (no output)":(i.className="output-panel error",i.textContent=l.error||"Execution failed"))}catch(a){i&&(i.className="output-panel error",i.textContent="Failed to execute code: "+a.message)}}async handleGoToDefinition(e){const t=this.editor.getModel();if(!t||!t.getWordAtPosition(e))return;const o=t.getLineContent(e.lineNumber).match(/^\\s*(?:from\\s+([\\w.]+)\\s+)?import\\s+([\\w,\\s]+)/);if(o){const r=`${(o[1]||o[2].split(",")[0].trim()).replace(".","/")}.py`;try{await this.openFile(r)}catch{console.log("Module file not found in workspace:",r)}}}setupEventListeners(){this.executeButton.addEventListener("click",()=>{this.executeCode("left")});const e=document.getElementById("splitToggleBtn");e&&e.addEventListener("click",()=>{this.toggleSplit()}),document.getElementById("newFileBtn").addEventListener("click",()=>{this.selectedDirectory="",this.showCreateDialog("file")}),document.getElementById("newFolderBtn").addEventListener("click",()=>{this.selectedDirectory="",this.showCreateDialog("folder")}),document.getElementById("refreshBtn").addEventListener("click",()=>{this.loadFileExplorer()}),document.addEventListener("keydown",t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),this.activeFile&&this.saveFile(this.activeFile)),(t.ctrlKey||t.metaKey)&&t.key==="r"&&(t.preventDefault(),this.executeCode()),t.key==="Escape"&&this.closeDialog()}),document.addEventListener("click",()=>{this.closeContextMenu()}),this.fileExplorer.addEventListener("contextmenu",t=>{(t.target===this.fileExplorer||t.target.closest(".file-item")===null)&&(t.preventDefault(),this.showEmptySpaceContextMenu(t))}),this.fileExplorer.addEventListener("click",t=>{(t.target===this.fileExplorer||t.target.classList.contains("folder-content")&&t.target.children.length===0)&&(document.querySelectorAll(".file-item.selected").forEach(s=>{s.classList.remove("selected")}),this.selectedDirectory="")})}showCreateDialog(e){this.closeDialog();const t=this.selectedDirectory||"",s=t?` in ${t}`:" in root",i=document.createElement("div");i.className="input-dialog",i.innerHTML=`
            <div class="input-dialog-content">
                <h3>Create New ${e==="file"?"File":"Folder"}${s}</h3>
                <input type="text" id="nameInput" placeholder="Enter ${e} name..." />
                <div class="input-dialog-buttons">
                    <button class="dialog-button secondary" onclick="this.closest('.input-dialog').remove()">Cancel</button>
                    <button class="dialog-button primary" id="createBtn">Create</button>
                </div>
            </div>
        `,document.body.appendChild(i);const o=i.querySelector("#nameInput"),n=i.querySelector("#createBtn");o.focus();const r=async()=>{const a=o.value.trim();if(a)try{const l=this.selectedDirectory?`${this.selectedDirectory}/${a}`:a;if(await this.checkIfFileExists(l)){alert(`A ${e} named "${a}" already exists in this directory.`);return}e==="file"?await this.createFile(l):await this.createFolder(l),i.remove(),this.loadFileExplorer()}catch(l){alert("Failed to create "+e+": "+l.message)}};n.addEventListener("click",r),o.addEventListener("keydown",a=>{a.key==="Enter"&&r()})}async createFile(e){const t=e.endsWith(".py")?`#!/usr/bin/env python3
"""
${e} - Description
"""


def main():
    pass


if __name__ == "__main__":
    main()
`:"";if(!(await fetch(this.buildUrl(`/api/files/${e}`),{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify({content:t})})).ok)throw new Error("Failed to create file")}async createFolder(e){if(!(await fetch(this.buildUrl("/api/mkdir"),{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify({path:e})})).ok)throw new Error("Failed to create folder")}async checkIfFileExists(e){try{return(await fetch(`/api/files/${e}`)).ok}catch{return!1}}closeDialog(){document.querySelectorAll(".input-dialog").forEach(t=>t.remove())}closeContextMenu(){document.querySelectorAll(".context-menu").forEach(t=>t.remove())}updateFilePathDisplay(e,t=!1){if(this.filePathBar)if(e){let s=e;t?(s=`Python Standard Library: ${e}`,this.filePathBar.className="file-path-bar stdlib"):(s=`Workspace: ${e}`,this.filePathBar.className="file-path-bar"),this.filePathBar.textContent=s,this.filePathBar.title=e}else this.filePathBar.textContent="",this.filePathBar.className="file-path-bar"}updateActiveFileHighlight(){if(document.querySelectorAll(".file-item.active").forEach(e=>{e.classList.remove("active")}),this.activeFile){const e=document.querySelector(`[data-path="${this.activeFile}"][data-type="file"]`);e&&e.classList.add("active")}}initializeSidebarResize(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebarResizer");let s=!1;t.addEventListener("mousedown",n=>{s=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",o),n.preventDefault()});const i=n=>{if(!s)return;const r=n.clientX,a=200,l=600;r>=a&&r<=l&&(e.style.width=r+"px")},o=()=>{s=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)}}showTabContextMenu(e,t,s="left"){this.closeContextMenu();const i=document.createElement("div");i.className="context-menu",i.style.left=e.pageX+"px",i.style.top=e.pageY+"px";const o=t.split("/").pop(),n=s==="left"?this.openTabs.get(t):this.rightOpenTabs.get(t),r=(n==null?void 0:n.isStdlib)||!1,m=[{text:"Close",action:s==="left"?()=>this.closeTab(t):()=>this.closeTabInSplit(t)},{text:"Close Others",action:s==="left"?()=>this.closeOtherTabs(t):()=>this.closeOtherTabsInSplit(t)},{text:"Close All",action:s==="left"?()=>this.closeAllTabs():()=>this.closeAllTabsInSplit()},{text:"Close Tabs to the Right",action:s==="left"?()=>this.closeTabsToRight(t):()=>this.closeTabsToRightInSplit(t)},{separator:!0},{text:"Copy File Name",action:()=>this.copyToClipboard(o)},{text:"Copy Path",action:()=>this.copyToClipboard(t)},{text:"Copy Relative Path",action:()=>this.copyToClipboard(`./${t}`)}];r||m.push({separator:!0},{text:"Download",action:()=>this.downloadItem(t)}),m.forEach(p=>{if(p.separator){const u=document.createElement("div");u.className="context-menu-separator",i.appendChild(u)}else{const u=document.createElement("div");u.className=`context-menu-item ${p.class||""}`,u.textContent=p.text,u.addEventListener("click",()=>{p.action(),this.closeContextMenu()}),i.appendChild(u)}}),document.body.appendChild(i),setTimeout(()=>{document.addEventListener("click",this.closeContextMenu.bind(this),{once:!0})},0)}closeOtherTabs(e){Array.from(document.querySelectorAll(".tab")).forEach(s=>{const i=s.dataset.filepath;i!==e&&this.closeTab(i)})}closeAllTabs(){Array.from(document.querySelectorAll(".tab")).forEach(t=>{this.closeTab(t.dataset.filepath)})}closeTabsToRight(e){const t=Array.from(document.querySelectorAll(".tab")),s=t.findIndex(i=>i.dataset.filepath===e);if(s!==-1)for(let i=s+1;i<t.length;i++)this.closeTab(t[i].dataset.filepath)}setupSplitResize(e,t,s){let i=!1,o=0,n=0,r=0;e.addEventListener("mousedown",a=>{i=!0,o=a.clientX,n=t.offsetWidth,r=s.offsetWidth,document.body.style.cursor="col-resize",a.preventDefault()}),document.addEventListener("mousemove",a=>{if(!i)return;const l=a.clientX-o,d=n+l,g=r-l,m=n+r;if(d>200&&g>200){const p=d/m*100,u=g/m*100;t.style.flex=`0 0 ${p}%`,s.style.flex=`0 0 ${u}%`}}),document.addEventListener("mouseup",()=>{i&&(i=!1,document.body.style.cursor="")})}async openFileInSplit(e){if(!(!this.splitViewActive||!this.rightEditor))try{if(this.rightOpenTabs.has(e)){this.switchToTabInSplit(e);return}const t=await fetch(this.buildUrl(`/api/files/${e}`));if(!t.ok)throw new Error(`Failed to load file: ${e}`);const s=await t.json(),i=h.createModel(s.content,this.getLanguageFromFile(e),f.file(e+"_split"));this.rightOpenTabs.set(e,{model:i,saved:!0,isStdlib:e.startsWith("/usr/local/lib/python3.11/")}),this.createTabInSplit(e),this.switchToTabInSplit(e)}catch(t){alert(`Could not open file: ${e.split("/").pop()}
Error: ${t.message}`)}}createTabInSplit(e){const t=e.split("/").pop(),s=document.getElementById("tabBar2"),i=e.startsWith("/usr/local/lib/python3.11/"),o=document.createElement("div");o.className="tab",o.dataset.filepath=e,o.innerHTML=`
            <span class="tab-label">${t}${i?" (read-only)":""}</span>
            <i class="codicon codicon-close tab-close"></i>
        `,i&&o.classList.add("stdlib-tab"),o.setAttribute("draggable","true"),o.addEventListener("click",n=>{n.target.classList.contains("tab-close")?this.closeTabInSplit(e):(this.focusedEditor="right",this.switchToTabInSplit(e),this.updateEditorFocusVisual())}),o.addEventListener("dragstart",n=>{n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",e),n.dataTransfer.setData("editor-group","right"),o.classList.add("dragging")}),o.addEventListener("dragend",n=>{o.classList.remove("dragging"),document.querySelectorAll(".tab").forEach(r=>r.classList.remove("drag-over"))}),o.addEventListener("dragover",n=>{n.preventDefault(),n.dataTransfer.dropEffect="move";const r=document.querySelector(".tab.dragging");if(r&&r!==o&&r.closest("#tabBar2")){const a=o.getBoundingClientRect(),l=a.left+a.width/2;n.clientX<l?o.parentNode.insertBefore(r,o):o.parentNode.insertBefore(r,o.nextSibling)}}),o.addEventListener("contextmenu",n=>{n.preventDefault(),this.showTabContextMenu(n,e,"right")}),s.appendChild(o)}switchToTabInSplit(e){document.querySelectorAll("#tabBar2 .tab").forEach(i=>{i.classList.remove("active")});const t=document.querySelector(`#tabBar2 [data-filepath="${e}"]`);t&&t.classList.add("active");const s=this.rightOpenTabs.get(e);if(s&&this.rightEditor){this.rightEditor.setModel(s.model),this.rightActiveFile=e;const i=document.getElementById("filePathBar2");i&&(i.textContent=e);const o=document.getElementById("executeButton2");if(o){const n=e.endsWith(".py");o.style.display=n&&!s.isStdlib?"block":"none"}this.setupModelSync(e)}}closeTabInSplit(e){this.cleanupSyncListener(e);const t=this.rightOpenTabs.get(e);t&&(t.model.dispose(),this.rightOpenTabs.delete(e));const s=document.querySelector(`#tabBar2 [data-filepath="${e}"]`);if(s&&s.remove(),this.rightOpenTabs.size===0)this.closeSplitView();else if(this.rightActiveFile===e){const i=document.querySelectorAll("#tabBar2 .tab");i.length>0&&this.switchToTabInSplit(i[0].dataset.filepath)}}closeOtherTabsInSplit(e){Array.from(document.querySelectorAll("#tabBar2 .tab")).forEach(s=>{const i=s.dataset.filepath;i!==e&&this.closeTabInSplit(i)})}closeAllTabsInSplit(){Array.from(document.querySelectorAll("#tabBar2 .tab")).forEach(t=>{this.closeTabInSplit(t.dataset.filepath)})}closeTabsToRightInSplit(e){const t=Array.from(document.querySelectorAll("#tabBar2 .tab")),s=t.findIndex(i=>i.dataset.filepath===e);if(s!==-1)for(let i=s+1;i<t.length;i++)this.closeTabInSplit(t[i].dataset.filepath)}closeSplitView(e=!1){if(!this.splitViewActive)return;e&&this.rightOpenTabs.forEach((o,n)=>{if(!this.openTabs.has(n)){const r=h.createModel(o.model.getValue(),o.model.getLanguageId(),f.file(n));this.openTabs.set(n,{model:r,saved:o.saved,isStdlib:o.isStdlib}),this.createTab(n)}}),this.rightEditor&&(this.rightEditor.dispose(),this.rightEditor=null),this.rightOpenTabs.forEach(o=>{o.model.dispose()}),this.rightOpenTabs.clear(),this.rightActiveFile=null;const t=document.getElementById("editorGroup2"),s=document.getElementById("splitDivider"),i=document.getElementById("editorGroup1");t&&t.remove(),s&&s.remove(),i&&(i.classList.remove("split"),i.style.flex="1"),this.splitViewActive=!1,this.focusedEditor="left",this.cleanupAllSyncListeners(),this.updateSplitButtonIcon()}setupModelSync(e){const t=this.openTabs.get(e),s=this.rightOpenTabs.get(e);if(!t||!s||!this.splitViewActive)return;this.cleanupSyncListener(e);const i=t.model,o=s.model,n=i.onDidChangeContent(a=>{this.syncInProgress||(this.syncInProgress=!0,a.changes.forEach(l=>{const d=new b(l.range.startLineNumber,l.range.startColumn,l.range.endLineNumber,l.range.endColumn);o.pushEditOperations([],[{range:d,text:l.text}],()=>null)}),this.syncInProgress=!1)}),r=o.onDidChangeContent(a=>{this.syncInProgress||(this.syncInProgress=!0,a.changes.forEach(l=>{const d=new b(l.range.startLineNumber,l.range.startColumn,l.range.endLineNumber,l.range.endColumn);i.pushEditOperations([],[{range:d,text:l.text}],()=>null)}),this.syncInProgress=!1)});this.modelChangeListeners.set(e,{leftListener:n,rightListener:r})}cleanupSyncListener(e){const t=this.modelChangeListeners.get(e);t&&(t.leftListener.dispose(),t.rightListener.dispose(),this.modelChangeListeners.delete(e))}cleanupAllSyncListeners(){this.modelChangeListeners.forEach(e=>{e.leftListener.dispose(),e.rightListener.dispose()}),this.modelChangeListeners.clear()}toggleSplit(){this.splitViewActive?this.closeSplitView(!0):this.createSplitView()}createSplitView(){if(this.splitViewActive)return;const e=document.getElementById("editorArea"),t=document.getElementById("editorGroup1"),s=document.createElement("div");s.className="split-divider",s.id="splitDivider";const i=document.createElement("div");i.className="editor-group",i.id="editorGroup2",i.innerHTML=`
            <div class="tab-bar" id="tabBar2"></div>
            <div class="file-path-bar" id="filePathBar2"></div>
            <div class="editor-container">
                <div id="editor2"></div>
                <button class="execute-button" id="executeButton2" style="display: none;">Run</button>
            </div>
            <div class="output-panel" id="outputPanel2" style="display: none;"></div>
        `,t.classList.add("split"),e.appendChild(s),e.appendChild(i),this.rightEditor=h.create(document.getElementById("editor2"),{value:"# Click here and open a file to edit",language:"python",theme:"vs-dark",fontSize:14,lineNumbers:"on",minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,wordWrap:"on",folding:!0,foldingStrategy:"indentation",showFoldingControls:"always",tabSize:4,insertSpaces:!0,autoIndent:"full",formatOnPaste:!0,formatOnType:!0,bracketPairColorization:{enabled:!0}}),this.splitViewActive=!0,this.setupSplitResize(s,t,i);const o=document.getElementById("executeButton2");o&&o.addEventListener("click",()=>{this.executeCode("right")}),this.setupEditorFocusTracking(),this.setupTabBarDropZones(),this.updateSplitButtonIcon()}setupTabBarDropZones(){const e=document.getElementById("tabBar"),t=document.getElementById("tabBar2");e&&this.setupTabBarDrop(e,"left"),t&&this.setupTabBarDrop(t,"right")}setupTabBarDrop(e,t){e.addEventListener("dragover",s=>{document.querySelector(".tab.dragging")&&(s.preventDefault(),s.dataTransfer.dropEffect="move",e.style.background="rgba(0, 122, 204, 0.1)")}),e.addEventListener("dragleave",s=>{s.target===e&&(e.style.background="")}),e.addEventListener("drop",s=>{s.preventDefault(),e.style.background="";const i=s.dataTransfer.getData("text/plain"),o=s.dataTransfer.getData("editor-group");i&&o!==t&&this.moveTabBetweenEditors(i,o,t)})}async moveTabBetweenEditors(e,t,s){const i=t==="left"?this.openTabs:this.rightOpenTabs,o=s==="left"?this.openTabs:this.rightOpenTabs,n=i.get(e);if(!n)return;const r=h.createModel(n.model.getValue(),n.model.getLanguageId(),f.file(e+(s==="right"?"_split":"")));o.set(e,{model:r,saved:n.saved,isStdlib:n.isStdlib}),t==="left"?this.closeTab(e):this.closeTabInSplit(e),s==="left"?(this.createTab(e),this.switchToTab(e),this.focusedEditor="left"):(this.createTabInSplit(e),this.switchToTabInSplit(e),this.focusedEditor="right"),this.updateEditorFocusVisual()}updateSplitButtonIcon(){const e=document.getElementById("splitToggleBtn");if(e){const t=e.querySelector("i");t&&(this.splitViewActive?(t.className="codicon codicon-screen-normal",e.title="Close Split Editor"):(t.className="codicon codicon-split-horizontal",e.title="Split Editor"))}}setupEditorFocusTracking(){const e=document.querySelector("#editorGroup1 .editor-container");e&&e.addEventListener("click",()=>{this.focusedEditor="left",this.updateEditorFocusVisual()});const t=document.querySelector("#editorGroup2 .editor-container");t&&t.addEventListener("click",()=>{this.focusedEditor="right",this.updateEditorFocusVisual()})}updateEditorFocusVisual(){const e=document.getElementById("editorGroup1"),t=document.getElementById("editorGroup2");e&&t&&(this.focusedEditor==="left"?(e.style.opacity="1",t.style.opacity="0.7"):(e.style.opacity="0.7",t.style.opacity="1"))}showContextMenu(e,t,s){this.closeContextMenu();const i=document.createElement("div");i.className="context-menu",i.style.left=e.pageX+"px",i.style.top=e.pageY+"px",t.split("/").pop();const o=s==="directory";let n=[];o?n=[{text:"New File",action:()=>this.createFileInDirectory(t)},{text:"New Folder",action:()=>this.createFolderInDirectory(t)},{separator:!0},{text:"Rename",action:()=>this.renameItem(t,s)},{text:"Duplicate",action:()=>this.duplicateItem(t,s)},{separator:!0},{text:"Download as ZIP",action:()=>this.downloadItem(t)},{separator:!0},{text:"Copy Path",action:()=>this.copyToClipboard(t)},{text:"Copy Relative Path",action:()=>this.copyToClipboard(`./${t}`)},{separator:!0},{text:"Delete",action:()=>this.deleteItem(t,s),class:"destructive"}]:n=[{text:"Open",action:()=>this.openFile(t)},{separator:!0},{text:"Rename",action:()=>this.renameItem(t,s)},{text:"Duplicate",action:()=>this.duplicateItem(t,s)},{separator:!0},{text:"Download",action:()=>this.downloadItem(t)},{separator:!0},{text:"Copy Path",action:()=>this.copyToClipboard(t)},{text:"Copy Relative Path",action:()=>this.copyToClipboard(`./${t}`)},{separator:!0},{text:"Delete",action:()=>this.deleteItem(t,s),class:"destructive"}],n.forEach(r=>{if(r.separator){const a=document.createElement("div");a.className="context-menu-separator",i.appendChild(a)}else{const a=document.createElement("div");a.className=`context-menu-item ${r.class||""}`,a.textContent=r.text,a.addEventListener("click",()=>{r.action(),this.closeContextMenu()}),i.appendChild(a)}}),document.body.appendChild(i),setTimeout(()=>{document.addEventListener("click",this.closeContextMenu.bind(this),{once:!0})},0)}showEmptySpaceContextMenu(e){this.closeContextMenu();const t=document.createElement("div");t.className="context-menu",t.style.left=e.pageX+"px",t.style.top=e.pageY+"px",[{text:"New File",action:()=>{this.selectedDirectory="",this.showCreateDialog("file")}},{text:"New Folder",action:()=>{this.selectedDirectory="",this.showCreateDialog("folder")}},{separator:!0},{text:"Refresh",action:()=>this.loadFileExplorer()}].forEach(i=>{if(i.separator){const o=document.createElement("div");o.className="context-menu-separator",o.style.cssText="height: 1px; background: #3e3e42; margin: 4px 0;",t.appendChild(o)}else{const o=document.createElement("div");o.className="context-menu-item",o.textContent=i.text,o.addEventListener("click",()=>{i.action(),this.closeContextMenu()}),t.appendChild(o)}}),document.body.appendChild(t),setTimeout(()=>{document.addEventListener("click",this.closeContextMenu.bind(this),{once:!0})},0)}async createFileInDirectory(e){this.selectedDirectory=e,this.showCreateDialog("file")}async createFolderInDirectory(e){this.selectedDirectory=e,this.showCreateDialog("folder")}async renameItem(e,t){const s=e.split("/").pop(),i=e.substring(0,e.lastIndexOf("/")),o=document.createElement("div");o.className="input-dialog",o.innerHTML=`
            <div class="input-dialog-content">
                <h3>Rename ${t==="file"?"File":"Folder"}</h3>
                <input type="text" id="renameInput" value="${s}" />
                <div class="input-dialog-buttons">
                    <button class="dialog-button secondary" onclick="this.closest('.input-dialog').remove()">Cancel</button>
                    <button class="dialog-button primary" id="renameBtn">Rename</button>
                </div>
            </div>
        `,document.body.appendChild(o);const n=o.querySelector("#renameInput"),r=o.querySelector("#renameBtn");n.focus(),n.select();const a=async()=>{const l=n.value.trim();if(!l||l===s){o.remove();return}try{const d=i?`${i}/${l}`:l;await this.moveItem(e,d),o.remove(),this.loadFileExplorer()}catch(d){alert("Failed to rename: "+d.message)}};r.addEventListener("click",a),n.addEventListener("keydown",l=>{l.key==="Enter"&&a(),l.key==="Escape"&&o.remove()})}async duplicateItem(e,t){const s=e.split("/").pop(),i=s.includes(".")?"."+s.split(".").pop():"",o=s.replace(i,""),n=e.substring(0,e.lastIndexOf("/"));let r=`${o}_copy${i}`,a=1;for(;await this.fileExists(n?`${n}/${r}`:r);)r=`${o}_copy${a}${i}`,a++;try{const l=n?`${n}/${r}`:r;await this.copyItem(e,l,t),this.loadFileExplorer()}catch(l){alert("Failed to duplicate: "+l.message)}}async deleteItem(e,t){const i=`Are you sure you want to delete "${e.split("/").pop()}"?`;if(confirm(i))try{if(!(await fetch(`/api/files/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");t==="file"&&this.openTabs.has(e)&&this.closeTab(e),(this.selectedDirectory===e||this.selectedDirectory.startsWith(e+"/"))&&(this.selectedDirectory=""),this.loadFileExplorer()}catch(o){alert("Failed to delete: "+o.message)}}async moveItem(e,t){const s=await fetch(`/api/files/${e}`);if(!s.ok)throw new Error("File not found");const i=await s.json();if(await fetch(`/api/files/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:i.content})}),await fetch(`/api/files/${e}`,{method:"DELETE"}),this.selectedDirectory===e?this.selectedDirectory=t:this.selectedDirectory.startsWith(e+"/")&&(this.selectedDirectory=this.selectedDirectory.replace(e,t)),this.openTabs.has(e)){const o=this.openTabs.get(e);this.openTabs.delete(e),this.openTabs.set(t,o),this.activeFile=t;const n=document.querySelector(`[data-filepath="${e}"]`);n&&(n.setAttribute("data-filepath",t),n.querySelector("span").textContent=t.split("/").pop())}}async copyItem(e,t,s){if(s==="file"){const i=await fetch(`/api/files/${e}`);if(!i.ok)throw new Error("File not found");const o=await i.json();await fetch(`/api/files/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o.content})})}else throw new Error("Directory duplication not yet implemented")}async fileExists(e){try{return(await fetch(`/api/files/${e}`)).ok}catch{return!1}}copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{const t=document.createElement("div");t.style.cssText=`
                position: fixed; top: 20px; right: 20px; background: #4CAF50;
                color: white; padding: 8px 16px; border-radius: 4px; z-index: 9999;
                font-size: 14px; pointer-events: none;
            `,t.textContent="Path copied to clipboard",document.body.appendChild(t),setTimeout(()=>t.remove(),2e3)}).catch(()=>{alert("Failed to copy to clipboard")})}downloadItem(e){const t=`/api/download/${e}`,s=document.createElement("a");s.href=t,s.download="",document.body.appendChild(s),s.click(),document.body.removeChild(s);const i=document.createElement("div");i.style.cssText=`
            position: fixed; top: 20px; right: 20px; background: #4CAF50;
            color: white; padding: 8px 16px; border-radius: 4px; z-index: 9999;
            font-size: 14px; pointer-events: none;
        `,i.textContent="Download started",document.body.appendChild(i),setTimeout(()=>i.remove(),2e3)}}document.addEventListener("DOMContentLoaded",()=>{new w});self.MonacoEnvironment={getWorkerUrl:function(y,e){return e==="json"?"./monaco-editor/esm/vs/language/json/json.worker.js":e==="css"||e==="scss"||e==="less"?"./monaco-editor/esm/vs/language/css/css.worker.js":e==="html"||e==="handlebars"||e==="razor"?"./monaco-editor/esm/vs/language/html/html.worker.js":e==="typescript"||e==="javascript"?"./monaco-editor/esm/vs/language/typescript/ts.worker.js":"./monaco-editor/esm/vs/editor/editor.worker.js"}};
